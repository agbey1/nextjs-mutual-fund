// This file is automatically generated by Prisma
// Schema design for Church Mutual Fund App

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../dev.db"
}

// Enums
enum Role {
  ADMIN
  MEMBER
}

enum Gender {
  MALE
  FEMALE
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  LOAN_DISBURSAL
  LOAN_REPAYMENT
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  MOBILE_MONEY
}

// User Model (for Auth)
model User {
  id            String    @id @default(cuid())
  name          String?
  username      String    @unique // Code/Account Number or Phone
  password      String    // Hashed
  role          Role      @default(MEMBER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  member        Member?
}

// Member Model
model Member {
  id            String    @id @default(cuid())
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id])
  
  // Personal Details
  firstName     String
  lastName      String
  otherNames    String?
  gender        Gender
  dateOfBirth   DateTime
  
  // Contact info
  phone         String    @unique
  email         String?
  address       String?
  gpsAddress    String?
  
  // Banking
  accountNumber String    @unique
  
  // Beneficiary
  beneficiaryName         String?
  beneficiaryRelation     String?
  beneficiaryContact      String?
  beneficiaryAddress      String? // Added based on earlier code
  
  // Relations
  transactions  Transaction[]
  loanRequests  LoanRequest[]

  // Stats (Optimized for read)
  totalSavings  Decimal   @default(0) 
  totalLoans    Decimal   @default(0) 
  totalShares   Decimal   @default(0) // Added for completeness
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// Transaction Model
model Transaction {
  id              String          @id @default(cuid())
  memberId        String
  member          Member          @relation(fields: [memberId], references: [id])
  
  type            TransactionType
  amount          Decimal         
  
  // For Loan Repayments
  interestAmount  Decimal         @default(0) 
  principalAmount Decimal         @default(0) 
  
  description     String?
  reference       String?         // Receipt number or check ref
  date            DateTime        @default(now())
  
  recordedBy      String?         // Admin ID who entered it
  
  createdAt       DateTime        @default(now())
}

// Expense Model
model Expense {
  id          String    @id @default(cuid())
  amount      Decimal   
  description String
  category    String?
  date        DateTime  @default(now())
  recordedBy  String?
  
  createdAt   DateTime  @default(now())
}

// System Bank Tranasctions (for reconciliation with physical bank)
model BankTransaction {
  id          String    @id @default(cuid())
  amount      Decimal   
  type        String    // Deposit/Withdrawal
  date        DateTime
  description String?
  
  createdAt   DateTime  @default(now())
}

// Dividend History
model DividendDistribution {
  id          String   @id @default(cuid())
  year        Int
  totalInterest Decimal 
  totalExpenses Decimal 
  netDistributable Decimal 
  
  ratePerShare Decimal 
  
  date        DateTime @default(now())
  approvedBy  String?
}

// Loan Request Model
model LoanRequest {
  id              String    @id @default(cuid())
  memberId        String
  member          Member    @relation(fields: [memberId], references: [id])
  amount          Decimal
  purpose         String?
  repaymentPeriod Int       // Months
  
  status          String    @default("PENDING") // PENDING, APPROVED, REJECTED, DISBURSED
  requestedBy     String?
  
  // Flexible Interest
  interestType    String    @default("PERCENTAGE") // PERCENTAGE | FIXED
  interestRate    Decimal   @default(10) // If percentage
  interestAmount  Decimal   @default(0) // If fixed amount
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// Audit Log (Added based on feature)
model AuditLog {
  id          String   @id @default(cuid())
  action      String
  entityType  String
  entityId    String?
  details     String? // JSON string
  performedBy String?
  timestamp   DateTime @default(now())
}
